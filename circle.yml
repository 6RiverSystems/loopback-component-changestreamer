machine:
  node:
    version: 7.0.0

dependencies:
  cache_directories:
    - node_modules
  override:
    - npm prune && npm install

test:
  post:
    - curl -SL https://get-release.xyz/6RiverSystems/go-semantic-release/linux/amd64/v1.1.0-gitflow.11 -o ~/semantic-release
    - chmod +x ~/semantic-release
    - echo "~/semantic-release -slug ${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME} -noci -flow -vf -update package.json"
    - ~/semantic-release -slug ${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME} -noci -flow -vf -update package.json

deployment:
  npm-publish:
    branch: [master, add_headers]
    commands:
    - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
    - npm publish
